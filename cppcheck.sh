#!/bin/bash

if [ "x$CPPCHECK" = "x" ]; then
  CPPCHECK=cppcheck
fi

if [ "x$CPUS" = "x" ]; then
  if [ -f /proc/cpuinfo ]; then
    CPUS=`grep -e "^processor" /proc/cpuinfo | wc -l`
  else
    CPUS=1
  fi
fi

if [ "x$DIR_OR_FILE" = "x" ]; then
  DIR_OR_FILE=elements/brn/
fi

$CPPCHECK -j $CPUS  -I include/ --enable=all --force --xml -UHAVE_BPF_TIMEVAL -UHAVE_EV_SET_UDATA_POINTER -UHAVE_IF_DATA_IFI_DATALEN -UHAVE_INT64_IS_LONG_USERLEVEL -UHAVE_KQUEUE -UHAVE_NET_BPF_H -UHAVE_NET_IF_DL_H -UHAVE_NET_IF_TAP_H -UHAVE_NET_IF_TUN_H -UHAVE_NET_IF_TYPES_H -UHAVE_NET_NETMAP_H -UHAVE_NEW_H -UHAVE_PROPER -UHAVE_DECL_PTHREAD_SETAFFINITY_NP -UHAVE_SOCKADDR_IN_SIN_LEN -UHAVE_SYS_EVENT_H -UHAVE_U_INT_TYPES -UHAVE_USER_MULTITHREAD -UHAVE_VALGRIND -UHAVE_VALGRIND_MEMCHECK_H -UHAVE_ADAPTIVE_SCHEDULER -U__APPLE__ -UCLICK_DEBUG_HASHMAP -DHAVE_INDIFFERENT_ALIGNMENT -DHAVE___THREAD_STORAGE_CLASS -DHAVE_ACCEPT_SOCKLEN_T -DHAVE_ALLOW_KQUEUE -DHAVE_ALLOW_POLL -DHAVE_ALLOW_SELECT -DHAVE_BYTESWAP_H -DHAVE_CLOCK_GETTIME -DHAVE_DECL_CLOCK_GETTIME -DHAVE_DECL_MADVISE -DHAVE_DECL_PCAP_SETNONBLOCK -DHAVE_DLFCN_H -DHAVE_DYNAMIC_LINKING -DHAVE_EXECINFO_H -DHAVE_FFS -DHAVE_FFSL -DHAVE_FFSLL -DHAVE_FLOAT_TYPES -DHAVE_GRP_H -DHAVE_IFADDRS_H -DHAVE_INT64_IS_LONG_LONG_USERLEVEL -DHAVE_INTTYPES_H -DHAVE_LARGE_FILE_SUPPORT -DHAVE_LINUX_IF_TUN_H -DHAVE_MADVISE -DHAVE_MMAP -DHAVE_NETDB_H -DHAVE_NETPACKET_PACKET_H -DHAVE_NEW_HDR -DHAVE_PCAP -DHAVE_PCAP_INJECT -DHAVE_PCAP_SENDPACKET -DHAVE_PCAP_SETDIRECTION -DHAVE_PCAP_SETNONBLOCK -DHAVE_PCAP_SET_IMMEDIATE_MODE -DHAVE_OPENSSL -DHAVE_TCC -DHAVE_LWIP -DHAVE_LIBIW -DHAVE_LIBFFTW3 -DHAVE_POLL_H -DHAVE_PSELECT -DHAVE_PLACEMENT_NEW -DHAVE_PWD_H -DHAVE_RANDOM -DHAVE_SIGACTION -DHAVE_SNPRINTF -DHAVE_STRERROR -DHAVE_STRINGS_H -DHAVE_STRNLEN -DHAVE_STRTOF -DHAVE_STRTOLD -DHAVE_STRTOUL -DHAVE_SYS_MMAN_H -DHAVE_TCGETPGRP -DHAVE_TERMIO_H -DHAVE_UNISTD_H -DHAVE_VSNPRINTF -DHAVE___BUILTIN_CLZ -DHAVE___BUILTIN_CLZL -DHAVE___BUILTIN_CLZLL -DHAVE___BUILTIN_FFS -DHAVE___BUILTIN_FFSL -DHAVE___BUILTIN_FFSLL -DHAVE___HAS_TRIVIAL_COPY -DHAVE___SYNC_SYNCHRONIZE -DHAVE_ADDRESSABLE_VA_LIST -DHAVE_ARITHMETIC_RIGHT_SHIFT -DHAVE_CXX_PRAGMA_INTERFACE -DHAVE_INDIFFERENT_ALIGNMENT -DHAVE_INT64_TYPES -DHAVE_IP6 -DHAVE_LONG_LONG -DHAVE_NANOTIMESTAMP_ENABLED -DHAVE_STRIDE_SCHED -DHAVE_STRING -DHAVE_STRUCT_TIMESPEC  -UHAVE_ADAPTIVE_SCHEDULER -UHAVE_CHECK_AUTOCONF_INCLUDED -UHAVE_CLICK_KERNEL -UHAVE_CLICK_KERNEL_TX_NOTIFY -UHAVE_CLICK_SKB_RECYCLE -UHAVE_INT64_IS_LONG_LINUXMODULE -UHAVE_INT64_IS_LONG_LONG_LINUXMODULE -UHAVE_KERNEL_ASSERT -UHAVE_LINUX_ASM_ALTERNATIVE_H -UHAVE_LINUX_ASM_SYSTEM_H -UHAVE_LINUX_ATOMIC_ADD_RETURN -UHAVE_LINUX_ATOMIC_SET_MASK -UHAVE_LINUX_ATOMIC_CMPXCHG -UHAVE_LINUX_FILES_LOCK -UHAVE_LINUX_FILES_LGLOCK -UHAVE_LINUX_D_MAKE_ROOT -UHAVE_LINUX_DEV_IOCTL -UHAVE_LINUX_DEVINET_IOCTL -UHAVE_LINUX_GET_MONOTONIC_COARSE -UHAVE_LINUX_GETBOOTTIME -UHAVE_LINUX_INET_CTL_SOCK_CREATE -UHAVE_LINUX_INET_IOCTL -UHAVE_LINUX_KTIME_H -UHAVE_LINUX_POLLING -UHAVE_LINUX_READ_NET_SKBCOUNT -UHAVE_LINUX_SB_LOCK -UHAVE_LINUX_SKB_SHINFO_GSO_SIZE -UHAVE_LINUX_SKB_SHINFO_IP6_FRAG_ID -UHAVE_LINUX_SKB_SHINFO_TX_FLAGS_UNION -UHAVE_LINUX_SKB_SHINFO_TX_FLAGS_SKBTX_DEV_ZEROCOPY -UHAVE_LINUX_SKB_SHINFO_TSO_SIZE -UHAVE_LINUX_SKB_SHINFO_UFO_SIZE -UHAVE_LINUX_SKBUFF_FCLONE -UHAVE_LINUX_SKBUFF_SECURITY -UHAVE_LINUX_STRLEN_EXPOSED -UHAVE_LINUX_SUPER_BLOCK_S_D_OP -UHAVE_LINUX_TULIP_INTERRUPT_HOOK -UHAVE_LINUXMODULE_2_6 -UHAVE_LINUXMODULE_MULTITHREAD -UHAVE_NET_ENABLE_TIMESTAMP -UHAVE_NETDEV_GET_TX_QUEUE -UHAVE_NETDEV_USES_DSA_TAGS -UHAVE_NETDEV_USES_TRAILER_TAGS -UHAVE_LINUX_NETDEV_RX_HANDLER_REGISTER -UHAVE_NETIF_RECEIVE_SKB_EXTENDED -UHAVE_NETIF_TX_LOCK -UHAVE_NETIF_TX_QUEUE_FROZEN -UHAVE_SKB_DST_DROP -UHAVE_SKB_LINEARIZE -UHAVE_SKB_RECYCLE -UHAVE_SKB_RECYCLE_CHECK -UHAVE_UINTPTR_T_LINUXMODULE -UCLICK_LINUXMODULE -UCLICK_MINIOS -UCLICK_BSDMODULE -UVALGRIND_MAKE_MEM_NOACCESS -UVALGRIND_MAKE_MEM_UNDEFINED -UFATAL -UERROR -UENOTSUPP -UENOTSUP -UVALGRIND_MEMPOOL_FREE -UVALGRIND_MEMPOOL_ALLOC -UHAVE_STRING_PROFILING -UCLICK_HASHMAP_UPGRADE_WARNINGS -UCLICK_DEBUG_SCHEDULING -UHAVE_TASK_HEAP -UHAVE_PERMSTRING -UHAVE_USER_MULTITHREAD -UHAVE_MULTITHREAD -UCLICK_COMPILING_CONFPARSE_CC -UHAVE_BOUND_PORT_TRANSFER -UCLICK_TOOL -UHAVE_CXX_RVALUE_REFERENCES -DWANT_MOD_USE_COUNT -DCLICK_USERLEVEL -UVALGRIND_MAKE_MEM_DEFINED -UCLICK_TIMEVAL_OPERATORS -D_FILE_OFFSET_BITS=64 -D__GNUC__ -U__i386__ -D__x86_64__ -U__CHAR_UNSIGNED__ -D__cplusplus -ULUNIXSTUFF -DNEED_DHCP_MESSAGE_TYPES -DNEED_DHCP_MESSAGE_OPTS -UEXPLICIT_TEMPLATE_INSTANCES -UDHCP_PACKETUTIL_DEBUG -ULOG0UNDEFINED -UEXPLICIT_TEMPLATE_INSTANCES -DSF_TX_ABORT -UKPROF -UUNDEF -Uprofiling_kernel -UFRHASHCODE -DCLICK_NS $DIR_OR_FILE 2> cppcheck.xml
